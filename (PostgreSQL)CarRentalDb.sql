CREATE DATABASE "CarRentalDb";

DROP TABLE IF EXISTS "Cars";
DROP TABLE IF EXISTS "Colors";
DROP TABLE IF EXISTS "Brands";
DROP TABLE IF EXISTS "Users";
DROP TABLE IF EXISTS "Customers";
DROP TABLE IF EXISTS "Rentals";

CREATE TABLE "Cars"
(
    "CarId"       INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    "BrandId"     INTEGER NOT NULL,
    "ColorId"     INTEGER NOT NULL,
    "ModelYear"   INTEGER NOT NULL,
    "DailyPrice"  INTEGER NOT NULL,
    "Description" TEXT    NOT NULL,
    CONSTRAINT PK_Car PRIMARY KEY ("CarId")
);

CREATE TABLE "Colors"
(
    "ColorId"   INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    "ColorName" TEXT    NOT NULL,
    CONSTRAINT PK_Color PRIMARY KEY ("ColorId"),
    CONSTRAINT UQ_Color UNIQUE ("ColorName")
);


CREATE TABLE "Brands"
(
    "BrandId"   INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    "BrandName" TEXT    NOT NULL,
    CONSTRAINT PK_Brand PRIMARY KEY ("BrandId"),
    CONSTRAINT UQ_Brand UNIQUE ("BrandName")
);

CREATE TABLE "Users"
(
    "UserId"    INTEGER                NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    "FirstName" CHARACTER VARYING(35)  NOT NULL,
    "LastName"  CHARACTER VARYING(35)  NOT NULL,
    "Email"     CHARACTER VARYING(320) NOT NULL,
    "Password"  CHARACTER VARYING(25)  NOT NULL,
    CONSTRAINT PK_User PRIMARY KEY ("UserId")
);

CREATE TABLE "Customers"
(
    "CustomerId"  INTEGER               NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    "UserId"      INTEGER               NOT NULL,
    "CompanyName" CHARACTER VARYING(35) NOT NULL,
    CONSTRAINT PK_Customer PRIMARY KEY ("CustomerId")
);

CREATE TABLE "Rentals"
(
    "RentalId"   INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    "CarId"      INTEGER NOT NULL,
    "CustomerId" INTEGER NOT NULL,
    "RentDate"   DATE    NOT NULL,
    "ReturnDate" DATE,
    CONSTRAINT PK_Rental PRIMARY KEY ("RentalId")
);

ALTER TABLE "Cars"
    ADD CONSTRAINT FK_Car_Brand FOREIGN KEY ("BrandId") REFERENCES "Brands" ("BrandId");
ALTER TABLE "Cars"
    ADD CONSTRAINT FK_Car_Color FOREIGN KEY ("ColorId") REFERENCES "Colors" ("ColorId");
ALTER TABLE "Customers"
    ADD CONSTRAINT FK_User_Customer FOREIGN KEY ("UserId") REFERENCES "Users" ("UserId");
ALTER TABLE "Rentals"
    ADD CONSTRAINT FK_Rental_Car FOREIGN KEY ("CarId") REFERENCES "Cars" ("CarId");
ALTER TABLE "Rentals"
    ADD CONSTRAINT FK_Rental_Customer FOREIGN KEY ("CustomerId") REFERENCES "Customers" ("CustomerId");
